<%- @api_policies.each_with_index do |policy, index| -%>
description: <%= policy['description'] %>
context:
  <%= policy['context']['type'] %>: '<%= policy['context']['rule'] %>'
for:
<%- policy['resource_types'].each do |resource| -%>
  <%= resource['type'] %>:
  <%- resource['rules'].each do |rule| -%>
  <%-   if rule['match']               -%>
    - match:
        <%- if rule['match']['path'] -%>
        path: '<%= rule['match']['path'] -%>'
        <%- else -%>
        name: '<%= rule['match']['name'] -%>'
        <%- end -%>
      allow: <%- if rule['allow'].eql?('*') -%>'<%= rule['allow'] -%>'<%- else -%>[<%= rule['allow'] -%>]<%- end %>
  <%-   elsif rule['equals']           -%>
    - equals:
        kind: <%= rule['equals']['kind'] %>
      allow: <%- if rule['allow'].eql?('*') -%>'<%= rule['allow'] -%>'<%- else -%>[<%= rule['allow'] -%>]<%- end %>
  <%-   else                             -%>
    - <%= rule['name'] %>: <%- if rule['name'].eql?('*') -%>'<%= rule['rule'] -%>'<%- else -%>[<%= rule['rule'] -%>]<%- end %>
  <%-   end                              -%>
  <%- end -%>
<%- end -%>
by:
<%- if !policy['by']['groups'].nil? && policy['by']['groups'] != :undef -%>
  group:
  <%- policy['by']['groups'].each do |group| -%>
   - <%= group %>
  <%- end -%>
<%- end -%>
<%- if !policy['by']['usernames'].nil? && policy['by']['usernames'] != :undef -%>
  username:
  <%- policy['by']['usernames'].each do |username| -%>
   - <%= username %>
  <%- end -%>
<%- end -%>
<%- if index != (@api_policies.length-1) -%>

---

<%- end -%>
<%- end -%>
